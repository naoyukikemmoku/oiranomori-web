---
import { topSwitch } from "../config/nav";
import HamburgerMenu from "./HamburgerMenu.astro";

const pathname = Astro.url.pathname;
const isActive = (href: string) => (href === "/" ? pathname === "/" : pathname.startsWith(href));
---

<header id="site-header" class="site-header">
  <div class="mx-auto flex max-w-6xl items-center justify-between gap-3 px-4 py-3">
    <a href="/" class="flex items-center gap-2 shrink-0" aria-label="おいらの森トップへ">
      <img src="/images/logo/logo-w512.png" alt="おいらの森ロゴ" class="h-8 w-auto" />
      <span class="sr-only">おいらの森</span>
    </a>

    <nav class="header-switch min-w-0" aria-label="森の切り替え">
      {topSwitch.map((item) => (
        <a
          href={item.href}
          class={`header-switch__item ${isActive(item.href) ? "is-active" : ""}`}
          aria-current={isActive(item.href) ? "page" : undefined}
        >
          <span class="hidden sm:inline">{item.href === "/" ? "ライトフォレスト" : "ディープフォレスト"}</span>
          <span class="sm:hidden text-center leading-tight">
            {item.href === "/" ? (
              <>
                Light
                <br />
                Forest
              </>
            ) : (
              <>
                Deep
                <br />
                Forest
              </>
            )}
          </span>
        </a>
      ))}
    </nav>

    <div class="flex items-center gap-2 shrink-0">
      <a href="/now/" class="header-weather hidden sm:inline-flex" aria-label="現在の天気">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="12" cy="12" r="4"></circle>
          <path d="M12 2v2"></path>
          <path d="M12 20v2"></path>
          <path d="M4.93 4.93l1.41 1.41"></path>
          <path d="M17.66 17.66l1.41 1.41"></path>
          <path d="M2 12h2"></path>
          <path d="M20 12h2"></path>
          <path d="M4.93 19.07l1.41-1.41"></path>
          <path d="M17.66 6.34l1.41-1.41"></path>
        </svg>
        <span class="tabular-nums">15.2℃</span>
      </a>
      <HamburgerMenu />
    </div>
  </div>
</header>

<script>
  const header = document.getElementById("site-header");
  let prevY = window.scrollY;

  const onScroll = () => {
    if (!header) return;
    const currY = window.scrollY;
    if (currY > 160 && currY > prevY) {
      header.classList.add("is-hidden");
    } else {
      header.classList.remove("is-hidden");
    }
    prevY = currY;
  };

  window.addEventListener("scroll", onScroll, { passive: true });
</script>
