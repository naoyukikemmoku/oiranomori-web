---
import { microcms } from "../../lib/microcms";
import type { Oshirase } from "../../lib/oshirase";

export async function getStaticPaths() {
  if (!microcms) {
    return [];
  }

  const data = await microcms.get<{ contents: { id: string }[] }>({
    endpoint: "oshirase",
    queries: { fields: ["id"], limit: 100 },
  });

  return data.contents.map((content) => ({
    params: { id: content.id },
  }));
}

const { id } = Astro.params;

if (!microcms || !id) {
  return Astro.redirect("/");
}

const data = await microcms.get<Oshirase & { image?: { url?: string } }>({
  endpoint: "oshirase",
  contentId: id,
});

const fmt = (iso: string) => iso?.slice(0, 10);
---

<main class="mx-auto max-w-3xl px-2 sm:px-4 py-10">
  <div class="text-sm opacity-70">
    {data.date ? fmt(data.date) : ""} / {data.category}
  </div>
  <h1 class="text-2xl font-bold mt-2 text-zinc-100">{data.title}</h1>

  {data.image?.url ? (
    <img src={data.image.url} alt="" class="mt-5 rounded-xl border border-zinc-800" />
  ) : null}

  <article class="prose prose-invert max-w-none mt-6 text-zinc-300" set:html={data.content} />
</main>
