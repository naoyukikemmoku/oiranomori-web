---
import { microcms } from "../../lib/microcms";
import type { Oshirase } from "../../lib/oshirase";

// 1. ビルド時に生成するページのリスト（ID一覧）を定義する
export async function getStaticPaths() {
  const data = await microcms.get({
    endpoint: "oshirase",
    queries: { fields: ["id"], limit: 100 }, // 必要なのはIDだけ、最大100件取得
  });

  return data.contents.map((content: any) => ({
    params: { id: content.id },
  }));
}

// 2. 実際の記事データを取得する
const { id } = Astro.params;

const data = await microcms.get<Oshirase>({
  endpoint: "oshirase",
  contentId: id!,
});

const fmt = (iso: string) => iso?.slice(0, 10);
---

<main class="mx-auto max-w-3xl px-2 sm:px-4 py-10">
  <div class="text-sm opacity-70">
    {data.date ? fmt(data.date) : ""} / {data.category}
  </div>
  <h1 class="text-2xl font-bold mt-2 text-zinc-100">{data.title}</h1>

  {data.image?.url ? (
    <img src={data.image.url} alt="" class="mt-5 rounded-xl border border-zinc-800" />
  ) : null}

  <article class="prose prose-invert max-w-none mt-6 text-zinc-300"
    set:html={data.content}
  />
</main>